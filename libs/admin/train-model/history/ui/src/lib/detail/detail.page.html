<aside class="relative">
  <ng-container *ngIf="selectedModel$ | async as model; else loading">
    <div class="top-right">
      <tui-svg
        class="mx-1 cursor-pointer text-red-500 hover:text-red-700"
        src="tuiIconRemoveLarge"
        routerLink=".."
      ></tui-svg>
    </div>
    <main>
      <h1>Model Detail</h1>

      <section class="model__information">
        <b class="text-gray-600">Name </b>
        <h2 class="mt-0">{{ model.name }}</h2>

        <b class="text-gray-600">Trained Images Count</b>
        <h3 class="mt-0 mb-3">{{ model.imageCount }}</h3>

        <b class="text-gray-600">Statistic</b>
        <h3 class="mt-0 mb-3">
          {{ model.statisticUrl }}
          <a
            class="openable"
            target="_blank"
            [href]="model.statisticUrl"
            *ngIf="model.statisticUrl; else notHasStatisticUrl"
            >Click to view statistic in new tab
            <tui-svg src="tuiIconExpand" tuiHint="Edit" class="mb-1"></tui-svg>
          </a>
          <ng-template #notHasStatisticUrl> None </ng-template>
        </h3>

        <b class="text-gray-600">Created at</b>
        <h3 class="mt-0 mb-3">{{ model.createdAt | date }}</h3>
      </section>

      <b class="text-gray-600 mb-1" *ngIf="model.modelStatus !== 'QUEUED'"> Status: </b>
      <h3 class="mt-0 mb-3">{{ model.modelStatus }}</h3>

      <b class="text-gray-600 mb-1"> Training Logs: </b>
      <h3 class="mt-0 mb-3">
        <a class="openable" *ngIf="model.modelStatus !== 'QUEUED'" (click)="openLog(logTemplate)"
          >Click to open
          <tui-svg src="tuiIconOutdentLarge" class="ml-1"></tui-svg>
        </a>
      </h3>

      <b class="text-gray-600 mb-1" *ngIf="model.modelStatus !== 'QUEUED'"> Training Images: </b>
      <h3 class="mt-0 mb-3">
        <a class="openable" *ngIf="model.modelStatus !== 'QUEUED'" (click)="downloadImages()"
          >Click to download
          <tui-svg src="tuiIconArrowDownLarge" class="ml-1"></tui-svg>
        </a>
      </h3>

      <b class="text-gray-600 mb-1">Applying Status: </b>
      <tui-badge
        size="l"
        [value]="model.isApplying ? 'Applying': 'None'"
        [status]="model.isApplying ? TUI_STATUS.SUCCESS : TUI_STATUS.ERROR"
        class="self-start mb-3"
      ></tui-badge>

      <button
        tuiButton
        size="m"
        appearance="primary"
        type="button"
        *ngIf="!model.isApplying"
        (click)="clickApply$.next()"
        [disabled]="model.modelStatus !== 'Successed'"
      >
        Apply for all
      </button>
    </main>
  </ng-container>
  <ng-template #loading> <tui-loader></tui-loader> </ng-template>
</aside>

<ng-template #logTemplate let-observer>
  <section class="w-full bg-gray-800 text-gray-100 text-left p-4 pb-40">
    <h1 class="flex items-center">
      <tui-svg src="tuiIconOutdentLarge" class="size-m"></tui-svg><b>Training Logs</b>
      <tui-marker-icon
        src="tuiIconArrowDownLarge"
        size="s"
        [mode]="TUI_MARKER_SUCCESS"
        (click)="downloadLog()"
        title="Click to download logs"
      ></tui-marker-icon>
    </h1>
    <div class="w-full flex flex-col" [innerHTML]="selectedModelLog$ | async"></div></section
></ng-template>
