<main class="flex">
  <section class="flex-grow">
    <section class="flex justify-between items-center">
      <h1>
        <tui-svg src="assets/taiga-ui/icons/car-sport.svg#car-sport" class="size-m"></tui-svg>
        Manage Cars
      </h1>
      <button
        tuiButton
        type="button"
        class="tui-space_right-3"
        size="m"
        appearance="outline"
        icon="assets/taiga-ui/icons/wall-clock.svg#wall-clock"
        routerLink="unapproved"
      >
        Unapproved Cars ({{unapprovedCarsCount$ | async}})
      </button>
    </section>

    <section class="w-100 flex flex-col items-stretch">
      <tui-input tuiTextfieldSize="xl" [formControl]="searchControl" class="w-100 pr-4 mb-4">
        Search by car name ...
      </tui-input>
      <ng-container *ngIf="(approvedCars$ | async) as carResponse">
        <table tuiTable [columns]="COLUMNS">
          <thead>
            <tr tuiThGroup>
              <th *tuiHead="'index'" tuiTh [sorter]="null">Index</th>
              <th *tuiHead="'deviceId'" tuiTh [sorter]="null">Device ID</th>
              <th *tuiHead="'name'" tuiTh [sorter]="null">Name</th>
              <th *tuiHead="'assignTo'" tuiTh [sorter]="null">
                Assigned to <tui-tag size="s" value="Staff" [status]="TUI_STATUS.PRIMARY"></tui-tag>
              </th>
              <th *tuiHead="'managedBy'" tuiTh [sorter]="null">
                Managed by
                <tui-tag size="s" value="Manager" [status]="TUI_STATUS.PRIMARY"></tui-tag>
              </th>
              <th *tuiHead="'isConnecting'" tuiTh [sorter]="null">Connecting Status</th>
              <th *tuiHead="'isAvailable'" tuiTh [sorter]="null">Activation Status</th>
            </tr>
          </thead>
          <tbody tuiTbody [data]="carResponse?.result || []">
            <tr
              *tuiRow="let item of (carResponse?.result || []); let index = index"
              tuiTr
              class="cursor-pointer"
              [class.active]="item.id === (selectedCarId$ | async)"
              (click)="selectRow$.next(item.id || 0)"
              [routerLink]="[item.id]"
            >
              <td *tuiCell="'index'" tuiTd><b>{{index + 1}}</b></td>
              <td *tuiCell="'deviceId'" tuiTd>{{item.deviceId}}</td>
              <td *tuiCell="'name'" tuiTd>{{item.name}}</td>
              <td *tuiCell="'assignTo'" tuiTd>
                {{item.assignTo?.lastName}} {{item.assignTo?.firstName}}<tui-svg
                  src="tuiIconExternal"
                  [tuiHint]="tuiHintAssignTo"
                  [routerLink]="'/staff/'+item.assignTo?.id"
                  class="hover:text-primary mb-1"
                ></tui-svg>
                <ng-template #tuiHintAssignTo>
                  <div class="cursor-pointer" [routerLink]="'/staff/'+item.assignTo?.id">
                    View
                    <strong>{{item.assignTo?.lastName}} {{item.assignTo?.firstName}}</strong> in
                    detail
                  </div>
                </ng-template>
              </td>
              <td *tuiCell="'managedBy'" tuiTd>
                {{item.managedBy?.lastName}} {{item.managedBy?.firstName}}<tui-svg
                  src="tuiIconExternal"
                  [tuiHint]="tuiHintManagedBy"
                  [routerLink]="'/staff/'+item.managedBy?.id"
                  class="hover:text-primary mb-1"
                ></tui-svg>
                <ng-template #tuiHintManagedBy>
                  <div class="cursor-pointer" [routerLink]="'/manager/'+item.managedBy?.id">
                    View
                    <strong>{{item.managedBy?.lastName}} {{item.managedBy?.firstName}}</strong> in
                    detail
                  </div>
                </ng-template>
              </td>
              <td *tuiCell="'isConnecting'" tuiTd>
                <tui-badge
                  size="m"
                  [value]="item.isConnecting ? 'Connected': 'Disconnected'"
                  [status]="item.isConnecting ? TUI_STATUS.SUCCESS : TUI_STATUS.ERROR"
                ></tui-badge>
              </td>
              <td *tuiCell="'isAvailable'" tuiTd>
                <tui-badge
                  size="m"
                  [value]="item.isAvailable ? 'Active': 'Inactive'"
                  [status]="item.isAvailable ? TUI_STATUS.SUCCESS : TUI_STATUS.ERROR"
                ></tui-badge>
              </td>
            </tr>
          </tbody>
        </table>
        <tui-pagination
          *ngIf="carResponse.count; else noRecord"
          [length]="calcTotalPageCount(carResponse.count)"
          [index]="0"
          class="mt-3 self-end"
        ></tui-pagination>
        <ng-template #noRecord>
          <p class="text-red-400 text-base">There is no matching result!</p>
        </ng-template>
      </ng-container>
    </section>
  </section>
  <router-outlet></router-outlet>
</main>
