<aside class="relative" [class.fullpage]="isFullPage$ | async">
  <ng-container *ngIf="selectedCar$ | async as car; else loading">
    <tui-svg
      class="top-right !right-10 cursor-pointer hover:text-green-600"
      src="tuiIconExternalLarge"
      [routerLink]="'/car/detail/'+car.id"
    ></tui-svg>
    <tui-svg
      class="top-right cursor-pointer hover:text-red-400"
      src="tuiIconRemoveLarge"
      routerLink="/car"
    ></tui-svg>
    <main class="p-5 flex flex-wrap">
      <h1 class="text-xl w-full">
        <tui-svg src="assets/taiga-ui/icons/car-sport.svg#car-sport" class="size-m"></tui-svg>
        Car Detail
      </h1>

      <section class="flex flex-col w-full">
        <b class="text-gray-600">Name </b>
        <h2 class="my-0">{{ car.name }}</h2>
        <div class="p-2 relative border border-gray-900">
          <adc-frontend-avatar
            class="tui-space_top-2"
            [url]="car.image"
            placeholderClass="!text-primary border border-solid border-primary rounded-full p-3"
            placeholderImageAsset="assets/taiga-ui/icons/car-sport.svg#car-sport"
            size="xl"
          ></adc-frontend-avatar>
        </div>
      </section>

      <section class="flex flex-col w-full fullpage_w-1/2">
        <b class="text-gray-600">Device ID</b>
        <h3 class="mt-0 mb-3">{{ car.deviceId }}</h3>
        <b class="text-gray-600">Config URL</b>
        <h3 class="mt-0 mb-3">{{ car.configUrl || 'Not yet' }}</h3>
        <b class="text-gray-600">Managed by</b>
        <h3 class="mt-0 mb-3">
          <span [routerLink]="'/manager/'+car.managedBy?.id" class="openable">
            {{car.managedBy ? '': 'Not yet'}} {{ car.managedBy?.firstName }} {{
            car.managedBy?.lastName }}<tui-svg
              src="tuiIconExternal"
              [tuiHint]="tuiHintManagedBy"
              [routerLink]="'/staff/'+car.managedBy?.id"
              class="mb-1"
            ></tui-svg>
          </span>
          <ng-template #tuiHintManagedBy>
            <div class="cursor-pointer" [routerLink]="'/manager/'+car.managedBy?.id">
              View
              <strong>{{car.managedBy?.lastName}} {{car.managedBy?.firstName}}</strong> in detail
            </div>
          </ng-template>
        </h3>
        <b class="text-gray-600">Assigned to</b>
        <h3 class="mt-0 mb-3">
          <span [routerLink]="'/staff/'+car.assignTo?.id" class="cursor-pointer hover:text-primary">
            {{car.assignTo?.firstName}} {{car.assignTo?.lastName}}<tui-svg
              src="tuiIconExternal"
              [tuiHint]="tuiHintAssignTo"
              class="mb-1"
            ></tui-svg>
          </span>
          <ng-template #tuiHintAssignTo>
            <div class="cursor-pointer" [routerLink]="'/staff/'+car.assignTo?.id">
              View
              <strong>{{car.assignTo?.lastName}} {{car.assignTo?.firstName}}</strong> in detail
            </div>
          </ng-template>
        </h3>
        <b class="text-gray-600">Created at</b>
        <h3 class="mt-0 mb-3">{{ car.createdAt | date }}</h3>
      </section>

      <section class="flex flex-col w-full fullpage_w-1/2">
        <b class="text-gray-600 mb-1">Connecting Status: </b>
        <tui-badge
          size="m"
          [value]="car.isConnecting ? 'Connected': 'Disconnected'"
          [status]="car.isConnecting ? TUI_STATUS.SUCCESS : TUI_STATUS.ERROR"
          class="self-start mb-3"
        ></tui-badge>

        <div class="flex flex-col mb-3">
          <b class="text-gray-600 mb-1">Approved Status</b>
          <tui-badge
            size="m"
            [value]="car.isApproved ? 'Approved' : 'Pending'"
            [status]="car.isApproved ? TUI_STATUS.SUCCESS : TUI_STATUS.WARNING"
            class="self-start"
          ></tui-badge>
          <button
            *ngIf="!car.isApproved"
            tuiButton
            size="m"
            appearance="primary"
            type="button"
            (click)="approveCar()"
            class="self-start"
          >
            Approve
          </button>
        </div>

        <b class="text-gray-600 mb-1">Activation Status</b>
        <tui-badge
          size="m"
          [value]="car.isAvailable ? 'Active' : 'Inactive'"
          [status]="car.isAvailable ? TUI_STATUS.SUCCESS : TUI_STATUS.ERROR"
          class="self-start mb-3"
        ></tui-badge>
        <button
          tuiButton
          size="m"
          appearance="outline"
          type="button"
          (click)="toggleActivation($event, car.isAvailable)"
          class="self-start"
        >
          {{car.isAvailable ? 'Deactivate': 'Reactivate'}}
        </button>
      </section>
      <section class="flex flex-col w-full">
        <b class="text-gray-600 mb-1">Issues</b>
        <ng-container *ngIf="isFullPage$ | async; else notShowCarIssue">
          <h3 *ngIf="car.issues; else carHasIssue" class="mt-0 mb-3">
            This car has no issues yet.
          </h3>
          <ng-template #carHasIssue>
            <table tuiTable [columns]="COLUMNS">
              <thead>
                <tr tuiThGroup>
                  <th *tuiHead="'index'" tuiTh [sorter]="null">Index</th>
                  <th *tuiHead="'type'" tuiTh [sorter]="null">Issue type</th>
                  <th *tuiHead="'createdAt'" tuiTh [sorter]="null">Created at</th>
                  <th *tuiHead="'image'" tuiTh [sorter]="null">Image</th>
                  <th *tuiHead="'description'" tuiTh [sorter]="null">Description</th>
                  <th *tuiHead="'location'" tuiTh [sorter]="null">Location</th>
                  <th *tuiHead="'isAvailable'" tuiTh [sorter]="null">Activation Status</th>
                </tr>
              </thead>
              <tbody tuiTbody [data]="car.issues || []">
                <tr
                  *tuiRow="let issue of (car.issues || []); let index = index"
                  tuiTr
                  class="cursor-pointer"
                  [routerLink]="[issue.id]"
                >
                  <td *tuiCell="'index'" tuiTd><b>{{index + 1}}</b></td>
                  <td *tuiCell="'type'" tuiTd>{{issue.type}}</td>
                  <td *tuiCell="'description'" tuiTd>{{issue.description}}</td>
                  <td *tuiCell="'createdAt'" tuiTd>{{issue.createdAt}}</td>
                  <td *tuiCell="'image'" tuiTd>{{issue.image}}</td>
                  <td *tuiCell="'location'" tuiTd>{{issue.location}}</td>
                  <td *tuiCell="'isAvailable'" tuiTd>
                    <tui-badge
                      size="m"
                      [value]="issue.isAvailable ? 'Active': 'Inactive'"
                      [status]="issue.isAvailable ? TUI_STATUS.SUCCESS : TUI_STATUS.ERROR"
                    ></tui-badge>
                  </td>
                </tr>
              </tbody>
            </table>
          </ng-template>
        </ng-container>
        <ng-template #notShowCarIssue>
          <h3 class="mt-0 mb-3">
            <span class="openable text-primary" [routerLink]="'/car/detail/'+car.id">Expand</span>
            to view full car issues.
          </h3>
        </ng-template>
      </section>
    </main>
  </ng-container>
  <ng-template #loading> <tui-loader></tui-loader> </ng-template>
</aside>
