<aside class="flex-grow flex-shrink-0 relative">
  <tui-svg
    class="top-right cursor-pointer hover:text-red-400"
    src="tuiIconRemoveLarge"
    routerLink="/staff"
  ></tui-svg>
  <form class="p-5 flex flex-col" [formGroup]="form">
    <h2>Create Staff</h2>

    <div class="p-4 flex justify-center items-center relative">
      <tui-input-file
        link="Choose an avatar"
        accept="image/*"
        formControlName="avatarImage"
        [maxFileSize]="MAXIMUM_IMAGE_SIZE"
        *ngIf="!form.value.avatarImage"
      >
      </tui-input-file>
      <div class="relative" *ngIf="form.value.avatarImage">
        <adc-frontend-avatar
          [url]=" form.value.avatarImage | dataUrl | async"
          size="xxl"
        ></adc-frontend-avatar>
        <input
          type="file"
          accept="image/*"
          class="hidden"
          (change)="clickChangeAvatar$.next($event)"
          #inputAvatar
        />
        <tui-marker-icon
          [mode]="MARKER_LINK"
          src="tuiIconUpload"
          size="s"
          class="bottom-right border border-solid border-primary"
          (click)="inputAvatar.click()"
        ></tui-marker-icon>
      </div>
    </div>
    <div class="flex flex-col mb-3">
      <label>First name <span class="text-red-500">*</span></label>
      <tui-input
        tuiTextfieldSize="m"
        [tuiTextfieldCleaner]="true"
        [tuiTextfieldLabelOutside]="true"
        tuiTextfieldExampleText="John Smith"
        [tuiHintContent]="firstNameHint"
        formControlName="firstName"
      >
        <span class="text-gray-300">
          First name here
          <tui-svg src="tuiIconEdit"></tui-svg>
        </span>
      </tui-input>
    </div>
    <div class="flex flex-col mb-3">
      <label>Last name <span class="text-red-500">*</span></label>
      <tui-input
        tuiTextfieldSize="m"
        [tuiTextfieldCleaner]="true"
        [tuiTextfieldLabelOutside]="true"
        tuiTextfieldExampleText="Last name here..."
        [tuiHintContent]="lastNameHint"
        formControlName="lastName"
      >
        <span class="text-gray-300">
          Last name here
          <tui-svg src="tuiIconEdit"></tui-svg>
        </span>
      </tui-input>
    </div>

    <div class="flex flex-col mb-3">
      <label>Email <span class="text-red-500">*</span></label>
      <tui-input
        tuiTextfieldSize="m"
        [tuiTextfieldCleaner]="true"
        [tuiTextfieldLabelOutside]="true"
        [tuiTextfieldType]="TUI_INPUT_EMAIL"
        [tuiHintContent]="emailHint"
        tuiTextfieldExampleText="Email here..."
        formControlName="email"
      >
        <span class="text-gray-300">
          Email here
          <tui-svg src="tuiIconEdit"></tui-svg>
        </span>
      </tui-input>
    </div>

    <div class="flex flex-col mb-3">
      <label>Password <span class="text-red-500">*</span></label>
      <tui-input-password
        tuiTextfieldSize="m"
        [tuiTextfieldLabelOutside]="true"
        [tuiHintContent]="passwordHint"
        tuiTextfieldExampleText="Password here..."
        formControlName="password"
      >
        <span class="text-gray-300">
          Password here
          <tui-svg src="tuiIconEdit"></tui-svg>
        </span>
      </tui-input-password>
    </div>

    <div class="flex flex-col mb-4">
      <label>Confirm Password <span class="text-red-500">*</span></label>
      <tui-input-password
        tuiTextfieldSize="m"
        [tuiTextfieldLabelOutside]="true"
        tuiTextfieldExampleText="Confirm password here..."
        [tuiHintContent]="confirmedPasswordInfo"
        tuiHintDirection="top-right"
        formControlName="confirmedPassword"
      >
        <span class="text-gray-300">
          Confirm password here
          <tui-svg src="tuiIconEdit"></tui-svg>
        </span>
      </tui-input-password>
    </div>

    <div class="flex flex-col mb-3">
      <label>Phone</label>
      <tui-input-phone
        tuiTextfieldSize="m"
        [tuiTextfieldCleaner]="true"
        [tuiTextfieldLabelOutside]="true"
        countryCode="+84"
        phoneMaskAfterCountryCode="### ###-###"
        tuiTextfieldExampleText="Phone here..."
        formControlName="phone"
      >
        <span class="text-gray-300">
          Phone here
          <tui-svg src="tuiIconEdit"></tui-svg>
        </span>
      </tui-input-phone>
    </div>

    <label class="mb-2">Managed by <span class="text-red-500">*</span></label>
    <tui-select
      *tuiLet="managers$ | async as managers"
      tuiTextfieldSize="m"
      [tuiTextfieldLabelOutside]="true"
      [tuiTextfieldCleaner]="true"
      [valueContent]="managers ? stringifyManagers(managers) : loading"
      tuiTextfieldExampleText="Select manager for this staff."
      formControlName="managedBy"
      class="mb-3"
    >
      <span class="text-gray-300">
        Select manager for this staff
        <tui-svg src="tuiIconEdit"></tui-svg>
      </span>

      <ng-template tuiDataList>
        <tui-data-list *ngIf="managers else loading">
          <button tuiOption *ngFor="let manager of managers" [value]="manager.id">
            {{manager.firstName}} {{manager.lastName}}
          </button>
        </tui-data-list>
      </ng-template>
    </tui-select>

    <tui-checkbox-labeled formControlName="clearWhenSuccess" size="m" class="mb-3">
      Clear when creating succeeded.
    </tui-checkbox-labeled>

    <button
      tuiButton
      (click)="clickCreate$.next()"
      size="m"
      [disabled]="form.invalid"
      [showLoader]="(loading$ | async) || false"
    >
      Create
    </button>
  </form>
  <ng-template #loading> Loading </ng-template>
</aside>

<ng-template #firstNameHint>
  <adc-frontend-error-hint
    name="First name"
    [errors]="this.form.get('firstName')?.errors"
    [errorChecks]="{required: true}"
  ></adc-frontend-error-hint>
</ng-template>

<ng-template #lastNameHint>
  <adc-frontend-error-hint
    name="Last name"
    [errors]="this.form.get('lastName')?.errors"
    [errorChecks]="{required: true}"
  ></adc-frontend-error-hint>
</ng-template>

<ng-template #emailHint>
  <adc-frontend-error-hint
    name="Email"
    [errors]="this.form.get('email')?.errors"
    [errorChecks]="{required: true}"
  ></adc-frontend-error-hint>
</ng-template>

<ng-template #passwordHint>
  <adc-frontend-error-hint
    name="Password"
    [errors]="this.form.get('password')?.errors"
    [errorChecks]="{minlength: true, maxlength: true}"
  ></adc-frontend-error-hint>
</ng-template>

<ng-template #confirmedPasswordInfo>
  <section class="flex flex-col flex-wrap">
    <div>
      <tui-svg
        [src]="
          form?.get('confirmedPassword')?.errors?.required ||
          form?.get('confirmedPassword')?.errors?.minlength
            ? 'tuiIconCloseCircleLarge'
            : 'tuiIconCheckCircleLarge'
        "
        class="size-s text-green-300"
        [class.text-red-300]="
          form?.get('confirmedPassword')?.errors?.required ||
          form?.get('confirmedPassword')?.errors?.minlength
        "
      ></tui-svg>
      Confirm password has 6 characters at least.
    </div>
    <div>
      <tui-svg
        [src]="
          form?.get('confirmedPassword')?.errors?.required ||
          form?.get('confirmedPassword')?.errors?.maxlength
            ? 'tuiIconCloseCircleLarge'
            : 'tuiIconCheckCircleLarge'
        "
        class="size-s text-green-300"
        [class.text-red-300]="
          form?.get('confirmedPassword')?.errors?.required ||
          form?.get('confirmedPassword')?.errors?.maxlength
        "
      ></tui-svg>
      Confirm password has 16 characters at max.
    </div>
    <div>
      <tui-svg
        [src]="
          form?.get('confirmedPassword')?.errors?.isMatching === false
            ? 'tuiIconCloseCircleLarge'
            : 'tuiIconCheckCircleLarge'
        "
        class="size-s text-green-300"
        [class.text-red-300]="form?.get('confirmedPassword')?.errors?.isMatching === false"
      ></tui-svg>
      Confirm password matches the new password.
    </div>
  </section>
</ng-template>
